"0",""
"0","# densify lines (make vertices every <line_sample_point_dist> metres)"
"0","near_lines_dense<- near_lines%>% smoothr::densify(max_distance=line_sample_point_dist)"
"0","near_lines_vertices<-st_cast(near_lines_dense,""POINT"",do_split = TRUE,warn = FALSE)"
"0",""
"0","# sample dem"
"0","raster_dem<-raster::raster(dem)"
"0","water_points$dem_wp<-raster::extract(raster_dem,st_transform(water_points,4326))"
"0","point_grid$dem_start<-raster::extract(raster_dem,st_transform(point_grid,4326))"
"0","near_lines$dem_start<-point_grid$dem_start"
"0",""
"0","near_lines_vertices$dem_path<-raster::extract(raster_dem,st_transform(near_lines_vertices,4326,quiet=TRUE))"
"0","max_dem_vertice<-near_lines_vertices %>% group_by(line_id) %>% filter(dem_path==max(dem_path)) %>% mutate(n=n()) %>% mutate(positionInCategory = 1:n()) %>% filter(positionInCategory == 1)"
"0","near_lines$peak_dem<-max_dem_vertice$dem_path"
"0",""
"0","# join height of water point to lines"
"0","d<-data.frame(water_points %>% select(wp_id,dem_wp)) %>% select(-geometry)"
"0","near_lines<- near_lines %>% left_join(d,by=""wp_id"") "
"0",""
"0","# calculate height differences"
"0","near_lines$st_peak_diff<-near_lines$peak_dem- near_lines$dem_start"
"0","near_lines$wp_peak_diff<-near_lines$peak_dem- near_lines$dem_wp"
"0",""
"0","# draw test plot including max DEM point in red"
"0","plot(st_geometry(point_grid))"
