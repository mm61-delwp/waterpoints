"0",""
"0","# get distance between high point and start and end points"
"0","high_point_to_wp<-st_distance(max_dem_vertice,water_points)"
"0","near_lines$peak_to_wp<-as.numeric(apply(high_point_to_wp, 1, FUN=min))"
"0","near_lines$dist<-as.numeric(st_length(near_lines)) "
"0","near_lines$peak_to_start<-near_lines$dist - near_lines$peak_to_wp"
"0",""
"0","# calculate slope"
"0","near_lines$slp_wp_dist<-sqrt((near_lines$wp_peak_diff^2)+(near_lines$peak_to_wp^2))"
"0","near_lines$slp_start_dist<-sqrt((near_lines$st_peak_diff^2)+(near_lines$peak_to_start^2))"
"0",""
"0","# calculate times"
"0","near_lines <- near_lines %>% mutate(time_full_ascend = (wp_peak_diff/1000)/full_ascend_kmh) %>% "
"0","  mutate(time_full_level = (dist/1000)/full_level_kmh) %>% "
"0","  mutate(time_full_descend = (st_peak_diff/1000)/full_level_kmh) %>% "
"0","  mutate(time_empty_ascend = (st_peak_diff/1000)/all_empty_kmh) %>% "
"0","  mutate(time_empty_level = (dist/1000)/all_empty_kmh) %>% "
"0","  mutate(time_empty_descend = (wp_peak_diff/1000)/all_empty_kmh) %>% "
"0","  mutate(total_time = round((time_full_ascend + time_full_level +time_full_descend +"
"0","           time_empty_ascend + time_empty_level + time_empty_descend)*60,1) + 2) #plus 2 minutes for fill time"
"0",""
"0","point_grid$total_time<-near_lines$total_time"
"0",""
"0","# calculate times using pythagoras (ie assuming heli flies on angles over)"
"0","near_lines <- near_lines %>% mutate(time_full_ascend_slope = (slp_wp_dist/1000)/full_ascend_kmh) %>% "
"0","  mutate(time_full_descend_slope = (slp_start_dist/1000)/full_level_kmh) %>% "
"0","  mutate(time_empty_ascend_slope = (slp_start_dist/1000)/all_empty_kmh) %>% "
"0","  mutate(time_empty_descend_slope = (slp_wp_dist/1000)/all_empty_kmh) %>% "
"0","  mutate(total_time_slope = round((time_full_ascend_slope +time_full_descend_slope +"
"0","           time_empty_ascend_slope + time_empty_descend_slope)*60,1) + 2) #plus 2 minutes for fill time"
"0",""
"0","point_grid$total_time<-near_lines$total_time"
"0","point_grid$total_time_slope<-near_lines$total_time_slope"
"0",""
"0","st_write(point_grid, paste0(output_path, ""point_grid.shp""), delete_layer = TRUE)"
"1","Deleting layer `"
"1","outputspoint_grid"
"1","' using driver `"
"1","ESRI Shapefile"
"1","'"
"1","
"
"1","Writing layer `"
"1","outputspoint_grid"
"1","' to data source "
"1","
"
"1","  "
"1","`"
"1","C:/Projects/20230829_HeliWaterPoints/test/outputspoint_grid.shp"
"1","' using driver `"
"1","ESRI Shapefile"
"1","'"
"1","
"
"1","Writing "
"1","700"
"1"," features with "
"1","5"
"1"," fields"
"1"," and geometry type "
"1","Point"
"1","."
"1","
"
"0","st_write(near_lines, paste0(output_path, ""near_lines.shp""), delete_layer = TRUE)"
"1","Deleting layer `"
"1","outputsnear_lines"
"1","' using driver `"
"1","ESRI Shapefile"
"1","'"
"1","
"
"1","Writing layer `"
"1","outputsnear_lines"
"1","' to data source "
"1","
"
"1","  "
"1","`"
"1","C:/Projects/20230829_HeliWaterPoints/test/outputsnear_lines.shp"
"1","' using driver `"
"1","ESRI Shapefile"
"1","'"
"1","
"
"1","Writing "
"1","700"
"1"," features with "
"1","24"
"1"," fields"
"1"," and geometry type "
"1","Line String"
"1","."
"1","
"
"0","#st_write(max_dem_vertice, paste0(""D:/TEMP/"", ""max_dem.shp""), delete_layer = TRUE)"
"0","#MJ writes point_grid and near_lines layer at the end"
"0",""
